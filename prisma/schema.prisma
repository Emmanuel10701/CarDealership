datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum UserRole {
  ADMIN
  MANAGER
  USER
}

enum UserStatus {
  ACTIVE
  INACTIVE
}

model User {
  id            String      @id @default(cuid())
  name          String
  email         String      @unique
  password      String
  phone         String?
  role          UserRole    @default(USER)
  status        UserStatus  @default(ACTIVE)
  avatar        String?     @default("https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80")
  joinDate      DateTime    @default(now())
  lastActive    DateTime?   @updatedAt
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  canManageListings Boolean @default(false)
  canApproveListings Boolean @default(false)
  canManageWebsite  Boolean @default(false)

    passwordResets PasswordReset[]  


  @@map("users")
}


model PasswordReset {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  createdAt DateTime @default(now())
  expires   DateTime

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model CarListing {
  id           String   @id @default(cuid())
  reference    String   @unique
  carName      String
  year         Int
  price        Float
  location     String
  carType      String
  mileage      Int
  transmission String
  fuelType     String
  features     Json     // Keep as Json for MySQL
  description  String   @db.Text  // ✅ CHANGE TO @db.Text FOR MYSQL
  sellerName   String
  sellerPhone  String
  sellerEmail  String
  file         String? 
  files        Json     // Keep as Json for MySQL
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("car_listings")
}


model Car {
  id               String   @id @default(cuid())
  reference        String   @unique
  carName          String
  year             Int
  price            Float
  location         String
  carType          String
  mileage          Int
  transmission     String
  fuelType         String
  engineSize       String?
  color            String?
  doors            Int?
  seats            Int?
  features         Json
  description  String   @db.Text  // ✅ CHANGE TO @db.Text FOR MYSQL
  carCondition     String?   @default("excellent")
  serviceHistory   String?   @default("full")
  accidentHistory  String?   @default("none")
  ownershipHistory String?
  roadTaxStatus    String?   @default("current")
  insuranceStatus  String?   @default("comprehensive")
  sellerName       String
  sellerPhone      String
  sellerEmail      String
  preferredContact String?   @default("phone")
  priceNegotiable  Boolean?  @default(true)
  testDrive        Boolean?  @default(true)
  warranty         Boolean?  @default(false)
  warrantyMonths   Int?
  serviceRecords   Boolean?  @default(true)
  originalPaint    Boolean?  @default(true)
  modifications    String?   @default("none")
  file             String?
  files            Json

 status           String?   @default("pending")
  adminNotes       String?   @default("")
  rejectionReason  String?   @default("")
  reviewedAt       DateTime?
  reviewedBy       String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@map("car")
}





model Subscriber {
  id        String   @id @default(cuid())
  email     String   @unique
  createdAt DateTime @default(now())

  @@map("subscribers")
}



enum PostStatus {
  DRAFT      // Private, only visible to editors
  PUBLISHED  // Publicly visible
  ARCHIVED   // Public but usually hidden from main lists
}

model BlogPost {
  // Core Fields
  id              String      @id @default(cuid())
  slug            String      @unique
  title           String      @db.VarChar(255)
  excerpt         String      @db.Text  // ✅ CHANGED TO @db.Text
  content         String      @db.Text
  
  // Author & Relations
  authorName      String      @default("Admin")

  // Media (Files and Images)
  mainImage       String?     // URL for the featured image
  imageAltText    String?     // Alt text for accessibility and image SEO

  // Publishing & Status
  status          PostStatus  @default(DRAFT)
  featured        Boolean     @default(false)
  tags            String      @db.Text  // ✅ CHANGED TO @db.Text
  category        String?

  // SEO Fields - NO LENGTH LIMITS
  metaTitle       String?     @db.Text  // ✅ CHANGED TO @db.Text
  metaDescription String?     @db.Text  // ✅ CHANGED TO @db.Text

  // Engagement Metrics
  views           Int         @default(0)
  likes           Int         @default(0)
  commentsCount   Int         @default(0)
  readTime        String?

  // Timestamps
  publishDate     DateTime?   // Manually set publication date
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  @@index([status, publishDate])

  @@map("blog_posts")
}


model ReviewLink {
  id          String   @id @default(cuid())
  title       String
  description String?
  uniqueCode  String   @unique
  status      ReviewLinkStatus @default(ACTIVE)
  createdById String   // Keep as string field but remove relation
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  reviews   Review[]
  
  @@map("review_links")
}

model Review {
  id            String   @id @default(cuid())
  reviewLinkId  String
  customerName  String?
  customerEmail String?
  rating        Int
  serviceType   ServiceType
  comments      String?
  status        ReviewStatus @default(PENDING)
  createdAt     DateTime @default(now())
  
  reviewLink ReviewLink @relation(fields: [reviewLinkId], references: [id])
  
  @@map("reviews")
}

enum ReviewLinkStatus {
  ACTIVE
  INACTIVE
  ARCHIVED
}

enum ReviewStatus {
  PENDING
  APPROVED
  REJECTED
}

enum ServiceType {
  CAR_PURCHASE
  CAR_SELLING
  TEST_DRIVE
  MAINTENANCE
  FINANCING
  INSURANCE
  OTHER
}